"use strict";(self.webpackChunkcardapio_web_chrome_extension=self.webpackChunkcardapio_web_chrome_extension||[]).push([[219],{51219:function(e,n,t){t.r(n),t.d(n,{default:function(){return Ge}});var a=t(4122),s=t(99084),r=t(15861),i=t(1413),o=t(93324),l=t(87757),c=t.n(l),d=t(47313),u=t(98931),m=t(19536),p=t(4942),x=t(5178),f=t(65033),v=t(24631),h=t(98664),g=t(56738),b=t(42195),j=t(46417);function y(e){var n,t=e.id,a=e.label,s=e.active,r=e.customMessage,i=e.onUpdate,l=e.customizableMessage,c=void 0===l||l,u=d.useRef(null),m=d.useState(!1),y=(0,o.Z)(m,2),Z=y[0],N=y[1],w="".concat(t,"_notification_active"),_="".concat(t,"_notification_message");d.useEffect((function(){N(Boolean(r))}),[t,r]),d.useEffect((function(){s||N(!1)}),[s]);var k=d.useCallback((function(){Z&&r&&i((0,p.Z)({},_,null)),N(!Z)}),[Z,i,_,r]);d.useEffect((function(){Z&&u.current&&u.current.focus()}),[Z]);var C=(null===(n=b.U.find((function(e){return e.id===t})))||void 0===n?void 0:n.message)||"";return(0,j.jsxs)("div",{className:"overflow-hidden border border-gray-200 border-solid rounded-md",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between p-3 space-x-2",children:[(0,j.jsx)(x.Z,{component:"legend",className:"font-medium",children:a}),(0,j.jsx)(g.Z,{checked:s,onChange:function(e){return i((0,p.Z)({},w,e.target.checked))}})]}),c&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(f.Z,{in:s&&Z,children:(0,j.jsxs)("div",{className:"px-3 pt-2 pb-3 space-y-3",children:[(0,j.jsx)(v.Z,{inputRef:u,label:"Mensagem personalizada",value:r||"",onChange:function(e){return i((0,p.Z)({},_,e.target.value))},placeholder:C,size:"small",variant:"outlined",fullWidth:!0,multiline:!0,rows:5}),(0,j.jsxs)("div",{className:"text-xs font-light text-gray-500",children:["Voc\xea pode usar os seguintes par\xe2metros na mensagem: ","{{nome}}",", ","{{numero_pedido}}",", ","{{valor_pedido}}",","," ","{{link_pedido}}",", ","{{link_avaliacao}}"," e"," ","{{resumo_pedido}}","."]})]})}),(0,j.jsx)(f.Z,{in:s,children:(0,j.jsxs)("div",{className:"flex items-center px-2 py-2 space-x-2 border-t border-gray-200 border-solid cursor-pointer hover:bg-gray-100 bg-gray-50",onClick:k,children:[(0,j.jsx)(h.Z,{className:"text-gray-400 transition-transform duration-700",sx:{transform:Z&&"rotate(180deg)"}}),(0,j.jsx)("span",{className:"font-light text-gray-600",children:Z?"Usar mensagem padr\xe3o":"Personalizar mensagem"})]})})]})]})}var Z=t(45987),N=t(44758),w=t(1550),_=t(96019),k=t(77327),C=t(88797),M=t(15480),z=t(83213),E=["name","label","value","onChange","options","optionValueKey","optionLabelKey","renderValue","helperText"],S=function(e){var n=e.name,t=e.label,a=e.value,s=e.onChange,r=e.options,o=e.optionValueKey,l=e.optionLabelKey,c=e.renderValue,d=e.helperText,u=(0,Z.Z)(e,E);return(0,j.jsxs)(w.Z,(0,i.Z)((0,i.Z)({variant:"outlined",size:"small",color:"primary",fullWidth:!0},u),{},{children:[(0,j.jsx)(_.Z,{id:"".concat(n,"-label"),children:t}),(0,j.jsx)(C.Z,{labelId:"".concat(n,"-label"),name:n,value:a,onChange:s,label:t,renderValue:c,multiple:!0,children:(r||[]).map((function(e){return(0,j.jsxs)(k.Z,{value:e[o],children:[(0,j.jsx)(N.Z,{checked:e.checked||!1,color:"primary",className:"p-0 pr-2"}),(0,j.jsx)(z.Z,{primary:e[l]})]},e[o])}))}),d&&(0,j.jsx)(M.Z,{children:d})]}))},V=d.memo(S),I=t(84463),A=t(88597);function W(){var e=(0,I.Z)("/api/v2/company/order_notification_settings",A.V),n=e.data,t=e.error,a=e.isValidating;return{data:n,isLoading:e.isLoading,isError:t,isValidating:a,mutate:e.mutate}}var B=t(53443);function R(e){return q.apply(this,arguments)}function q(){return(q=(0,r.Z)(c().mark((function e(n){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.Z.put("/api/v2/company/order_notification_settings",{order_notification_setting:n});case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return L.apply(this,arguments)}function L(){return(L=(0,r.Z)(c().mark((function e(n){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.Z.put("/api/v2/company/order_notification_settings",{order_notification_setting:{chatbot_customization:n}});case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,n,t,a){return D.apply(this,arguments)}function D(){return(D=(0,r.Z)(c().mark((function e(n,t,a,s){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.Z.put("/api/v1/user/companies/".concat(n),{company:{control_flag_attributes:(0,p.Z)({id:t.id},a,s)}});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T=t(45894),F=t(72289),H=t(83061),U=t(76447),K=t(29971),Y=t(3192),J=t(28485),X=t(65280),G=t(85281),Q={active:"bg-green-500",custom:"bg-blue-500",inactive:"bg-gray-400"};function $(e){var n,t,a,s,r,i=e.message,o=e.editBotResponseMessages,l=e.setOpenMessageCardDialog,c=i.active?(null===(n=i.customMessages)||void 0===n?void 0:n.length)>0?"custom":"active":"inactive";return(0,j.jsxs)("div",{onClick:function(e){e.stopPropagation(),i.active&&l(i.intention)},className:(0,H.Z)("flex items-center p-3 overflow-hidden border border-gray-200 border-solid rounded-md",i.active&&"cursor-pointer hover:bg-gray-50"),children:[(0,j.jsx)("div",{className:"flex items-center flex-1 space-x-1.5",children:(0,j.jsxs)(x.Z,{component:"legend",className:"flex flex-col space-y-0.5 font-medium",children:[(0,j.jsxs)("span",{children:[" ",b.Bz[i.intention]]}),(0,j.jsxs)("div",{className:"flex items-center space-x-1.5",children:[(0,j.jsxs)("span",{className:"relative flex h-2.5 w-2.5",children:[(0,j.jsx)("span",{className:(0,H.Z)("absolute w-full h-full rounded-full opacity-75",Q[c])}),(0,j.jsx)("span",{className:(0,H.Z)("h-2.5 w-2.5 rounded-full",Q[c])})]}),(0,j.jsx)("span",{className:"text-xs font-light",children:(null===(t=i.customMessages)||void 0===t?void 0:t.length)>0?(0,j.jsxs)(j.Fragment,{children:[null===(a=i.customMessages)||void 0===a?void 0:a.length," ",(null===(s=i.customMessages)||void 0===s?void 0:s.length)>1?"respostas":"resposta"," ","personalizada",(null===(r=i.customMessages)||void 0===r?void 0:r.length)>1&&"s"]}):"Resposta padr\xe3o"})]})]})}),(0,j.jsx)(g.Z,{size:"small",checked:i.active,onClick:function(e){e.stopPropagation(),o(i,"active",!i.active)}})]},i.intent)}var ee=t(42982),ne=t(35345),te=t(12279),ae=t.n(te),se=t(69522),re=t.n(se);function ie(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t="hover:bg-gray-100 leading-7 whitespace-nowrap border cursor-pointer my-3 px-2 py-1 border-1 border-solid border-gray-300 font-semibold rounded-md";return n?(0,j.jsx)("span",{class:t,contentEditable:"false",children:e.name}):'<span class="'.concat(t,'" contentEditable="false">').concat(e.name,"</span>")}function oe(e){var n=e.open,t=e.customMessage,a=e.onClose,s=e.onChange,i=e.company,l=(0,F.VY)(),u=d.useState(!1),m=(0,o.Z)(u,2),p=m[0],x=m[1],f=d.useState(""),v=(0,o.Z)(f,2),h=v[0],g=v[1],y=d.useState(0),Z=(0,o.Z)(y,2),N=Z[0],w=Z[1],_=d.useState(""),k=(0,o.Z)(_,2),C=k[0],M=k[1],z=d.useState(!1),E=(0,o.Z)(z,2),S=E[0],V=E[1],I=d.useRef(null),A=d.useMemo((function(){return re()((0,b.wD)(i).filter((function(e){var n;return(0,b.Jl)(null===t||void 0===t||null===(n=t.messageObj)||void 0===n?void 0:n.intention).includes(e.param)})),"category")||{}}),[i,t]),W=d.useCallback((function(){a&&!S&&a()}),[S,a]),B=d.useCallback(function(){var e=(0,r.Z)(c().mark((function e(n){var a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),!(N>450)){e.next=4;break}return l.info("Voc\xea ultrapassou o limite de caracteres por resposta! O m\xe1ximo permitido \xe9 de 450 caracteres"),e.abrupt("return",!1);case 4:if(!S){V(!0);try{void 0!==(null===t||void 0===t?void 0:t.id)?s(t.messageObj,"customMessages",t.messageObj.customMessages.map((function(e,n){return n===t.id?h:e}))):s(t.messageObj,"customMessages",[].concat((0,ee.Z)(null===(a=t.messageObj)||void 0===a?void 0:a.customMessages),[h])),W()}catch(r){l.error(r.message||"N\xe3o foi poss\xedvel concluir a opera\xe7\xe3o")}V(!1)}case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[l,W,S,s,t,N,h]),R=d.useMemo((function(){return ae()((function(){var e=function(e){var n=document.createElement("div");return n.innerHTML=e,n.querySelectorAll("span[data-param]").forEach((function(e){var n=e.getAttribute("data-param"),t=document.createTextNode(n);e.parentNode.replaceChild(t,e)})),n.innerText}(document.getElementById("textArea").innerHTML);g(e)}),200)}),[]),q=d.useCallback((function(){var e,n=document.getElementById("textArea"),t=(null===n||void 0===n||null===(e=n.innerText)||void 0===e?void 0:e.length)||0;w(t),R()}),[R]),O=d.useCallback((function(e){var n=e.target.parentElement;n&&(n.parentElement.removeChild(n),R())}),[R]),L=d.useCallback((function(e){return e.split(/(\{\{[^}]+\}\})/g).map((function(e){if(e.match(/\{\{[^}]+\}\}/)){var n=e,t=(0,b.wD)(i).find((function(e){return e.param===n}));if(!t)return e;var a=ie(t,!0);return(0,j.jsx)("span",{onClick:O,contentEditable:"false","data-param":"".concat(n),children:a})}return e}))}),[O,i]),P=d.useCallback((function(){null!==t&&void 0!==t&&t.message?(w(null===t||void 0===t?void 0:t.message.length),M(L(null===t||void 0===t?void 0:t.message)),g(null===t||void 0===t?void 0:t.message),x(void 0!==(null===t||void 0===t?void 0:t.id))):(w(0),M(""),g(""),x(!1))}),[t,L]);return d.useEffect((function(){n&&P()}),[n,P]),(0,j.jsx)(ne.Z,{open:n,title:p?"Editar mensagem personalizada":"Adicionar mensagem personalizada",loading:S,onClose:W,onSubmit:B,children:(0,j.jsxs)("div",{className:"p-1 space-y-4",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{ref:I,onInput:q,id:"textArea",contentEditable:!0,suppressContentEditableWarning:!0,style:{display:"inline-block",whiteSpace:"break-spaces"},className:"w-full p-3 overflow-auto border border-gray-300 border-solid rounded-md border-1 h-44",children:C}),(0,j.jsxs)("div",{className:"flex w-full font-light text-gray-500 p-0.5",children:[(0,j.jsxs)("span",{className:"flex-1 text-xs font-light",children:["Estilize a resposta com ",(0,j.jsx)("strong",{children:"negrito"})," (*texto*),"," ",(0,j.jsx)("i",{children:"it\xe1lico"})," (_texto_) ou ",(0,j.jsx)("s",{children:"riscado"})," (~texto~)."]}),(0,j.jsxs)("span",{className:(0,H.Z)(N>450?"text-red-700":""),children:[N,"/450"]})]})]}),(0,j.jsx)("div",{className:"flex flex-col space-y-4",children:Object.keys(A).map((function(e){var n=A[e];return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{className:"font-semibold",children:e}),(0,j.jsx)("div",{className:"flex flex-row flex-wrap gap-4",children:n.map((function(e){return(0,j.jsx)("button",{type:"button",className:"p-2 font-semibold text-gray-500 bg-white border border-gray-300 border-solid rounded-lg cursor-pointer hover:bg-gray-100 border-1",onClick:function(){!function(e){var n=document.getElementById("textArea"),t=window.getSelection(),a=t.focusNode,s=ie(e),r=document.createElement("span");if(r.contentEditable=!1,r.setAttribute("data-param","".concat(e.param)),r.addEventListener("click",O),r.innerHTML=s,!a||a.parentElement!==n&&a!==n){var i=document.createRange();n.appendChild(r),i.selectNodeContents(n),i.collapse(!1),t.removeAllRanges(),t.addRange(i),n.focus()}else{var o=window.getSelection(),l=o.getRangeAt(0);o.rangeCount>0&&(l.deleteContents(),l.insertNode(r),l.collapse(!1),t.removeAllRanges(),t.addRange(l))}q()}(e)},children:e.name})}))})]})}))})]})})}var le=t(22260),ce=t(69099),de=t(19713),ue=t(21961),me=t(20290);function pe(e){var n=null===e||void 0===e?void 0:e.split(/(\*.*?\*|~.*?~|_.*?_)/g);return(null===n||void 0===n?void 0:n.length)>1?n.map((function(e){var n=pe(e.slice(1,-1));return e.startsWith("*")&&e.endsWith("*")?(0,j.jsx)("strong",{className:"font-medium",children:n}):e.startsWith("_")&&e.endsWith("_")?(0,j.jsx)("i",{children:n}):e.startsWith("~")&&e.endsWith("~")?(0,j.jsx)("s",{children:n}):e})):e}function xe(e,n){return e.split(/(\{\{[^}]+\}\})/g).map((function(e,t){var a;if(e.match(/\{\{[^}]+\}\}/))return(null===(a=(0,b.wD)(n).find((function(n){return n.param===e})))||void 0===a?void 0:a.example)||e;var s=e.split("\n").map((function(n,t){return(0,j.jsxs)(d.Fragment,{children:[pe(n),t<e.split("\n").length-1&&(0,j.jsx)("br",{})]},t)}));return(0,j.jsx)(d.Fragment,{children:s},t)}))}function fe(e){var n=e.data,t=e.onClick,a=e.onDelete,s=e.company,r=d.useMemo((function(){return n.message.split("{{splitMessages}}")}),[n]);return(0,j.jsxs)("div",{className:"flex flex-col p-2 space-y-2 font-normal bg-gray-100 border border-gray-200 border-solid rounded-md",children:[r.map((function(e){return(0,j.jsx)("div",{className:"flex-1 p-2 bg-white border border-gray-300 border-solid rounded-md",children:xe(e,s)})})),(0,j.jsxs)("div",{className:"flex w-full space-x-2",children:[(0,j.jsx)(ce.Z,{variant:"text",color:"inherit",startIcon:(0,j.jsx)(me.Z,{}),className:"w-full leading-none text-gray-500",onClick:function(e){e.stopPropagation(),t({open:!0,customMessage:n})},children:(0,j.jsx)("span",{children:"Editar"})}),(0,j.jsx)(ce.Z,{variant:"text",color:"inherit",startIcon:(0,j.jsx)(ue.Z,{}),className:"w-full leading-none text-gray-500",onClick:function(e){e.stopPropagation(),a(n.id)},children:(0,j.jsx)("span",{children:"Excluir"})})]})]})}var ve=t(45522),he=t.n(ve),ge=t(10658),be=t.n(ge);function je(e){var n,t=e.message,a=e.openEditorNewMessage,s=e.editBotResponseMessages,r=e.company,i=e.onClose,l=d.useState(null),c=(0,o.Z)(l,2),u=c[0],m=c[1];d.useEffect((function(){t&&m(t)}),[t]);var p=(0,b.Sr)(r,null===u||void 0===u?void 0:u.intention);return(0,j.jsx)(ne.Z,{open:!he()(t),title:b.Bz[null===u||void 0===u?void 0:u.intention]||"",onClose:i,children:(0,j.jsxs)("div",{className:"p-0.5 space-y-4",children:[(0,j.jsxs)("div",{style:{backgroundColor:"#f0ebe3"},className:"flex flex-col p-3 space-y-2 font-normal border border-gray-200 border-solid rounded-md ",children:[(0,j.jsxs)("div",{className:(0,H.Z)("flex flex-col flex-1 p-2 bg-white border border-gray-300 border-solid rounded-md",!((null===u||void 0===u?void 0:u.customMessages.length)>0)&&"mr-10"),children:[(0,j.jsx)("div",{className:"w-full",children:null===p||void 0===p?void 0:p.client}),(0,j.jsx)("div",{className:"w-full text-xs text-right",children:be()(new Date).format("HH:mm")})]}),!((null===u||void 0===u?void 0:u.customMessages.length)>0)&&(0,j.jsxs)("div",{style:{backgroundColor:"#d9fdd3"},className:"flex flex-col flex-1 p-2 ml-10 bg-white border border-gray-300 border-solid rounded-md",children:[(0,j.jsx)("div",{className:"w-full",children:null===p||void 0===p?void 0:p.bot}),(0,j.jsx)("div",{className:"w-full text-xs text-right",children:be()(new Date).format("HH:mm")})]})]}),0===(null===u||void 0===u||null===(n=u.customMessages)||void 0===n?void 0:n.length)&&(0,j.jsx)("div",{className:"w-full font-medium text-center text-gray-400 text-md",children:"Se preferir n\xe3o utilizar a resposta padr\xe3o acima, clique no bot\xe3o abaixo para cadastrar uma resposta personalizada"}),null===u||void 0===u?void 0:u.customMessages.map((function(e,n){return(0,j.jsx)(fe,{data:{id:n,message:e,messageObj:u},company:r,onClick:a,onDelete:function(){var e=u.customMessages;e.splice(n,1),s(t,"customMessages",e)}},u.intention+n)})),(null===u||void 0===u?void 0:u.customMessages.length)>2?(0,j.jsx)("div",{className:"w-full p-2 font-bold leading-none text-center text-gray-400 bg-white border border-gray-300 border-solid rounded-md shadow-none",children:"O n\xfamero m\xe1ximo de respostas por inten\xe7\xe3o foi atingido"}):(0,j.jsxs)(j.Fragment,{children:[(null===u||void 0===u?void 0:u.customMessages.length)>0&&(0,j.jsx)("div",{className:"w-full font-light text-center text-gray-500 text-md",children:"Adicione mais op\xe7\xf5es de respostas para uma melhor experi\xeancia, o sistema escolher\xe1 aleatoriamente uma delas"}),(0,j.jsx)(le.Z,{title:"Nova resposta personalizada",children:(0,j.jsx)(ce.Z,{variant:"contained",color:"primary",size:"large",startIcon:(0,j.jsx)(de.Z,{}),className:"w-full leading-none",onClick:function(){return a({open:!0,customMessage:{messageObj:u}})},children:(0,j.jsx)("span",{children:"Adicionar resposta"})})})]})]})})}function ye(){var e=(0,F.VY)(),n=W(),t=n.data,a=n.mutate,s=d.useState({open:!1,customMessage:null}),l=(0,o.Z)(s,2),u=l[0],m=l[1],x=d.useState(b._C),f=(0,o.Z)(x,2),v=f[0],h=f[1],g=d.useState(null),y=(0,o.Z)(g,2),Z=y[0],N=y[1],w=(0,T.v9)((function(e){return e.main.company.company})),_=null===w||void 0===w?void 0:w.flags,k=d.useMemo((function(){return!(null===_||void 0===_||!_.chatbot_cwai_active)}),[null===_||void 0===_?void 0:_.chatbot_cwai_active]);d.useEffect((function(){if(Array.isArray(t.chatbot_customization)){var e=b._C.map((function(e){return t.chatbot_customization.find((function(n){return n.intention===e.intention}))||e}));h(e)}}),[t]);var C=d.useCallback(function(){var n=(0,r.Z)(c().mark((function n(t,s,r){var o,l;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=v.map((function(e){return t.intention===e.intention?(0,i.Z)((0,i.Z)({},e),{},(0,p.Z)({},s,r)):e})),n.prev=1,h(o),n.next=5,O(o);case 5:return l=n.sent,n.next=8,a(l,{revalidate:!1});case 8:e.success("Salvo com sucesso. Atualize a p\xe1gina para aplicar as altera\xe7\xf5es"),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(1),e.error("Erro ao salvar");case 14:case"end":return n.stop()}}),n,null,[[1,11]])})));return function(e,t,a){return n.apply(this,arguments)}}(),[h,v,a,e]);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{className:"font-medium px-3",children:"Respostas do ChatBot"}),(0,j.jsx)("div",{className:"flex-1 p-3 space-y-3 overflow-auto",children:null===v||void 0===v?void 0:v.filter((function(e){return!k||"salesRecovery"===e.intention})).map((function(e){return(0,j.jsx)($,{message:e,setOpenMessageCardDialog:N,editBotResponseMessages:C},e.intention)}))}),k&&(0,j.jsxs)("div",{className:"p-3 mb-4 mt-1 text-xs text-purple-600 bg-purple-50",children:[(0,j.jsx)("strong",{children:"Nova IA ativa:"}),' Apenas a mensagem de "Abandono de carrinho" est\xe1 dispon\xedvel para personaliza\xe7\xe3o.']}),(0,j.jsx)(oe,{open:u.open,customMessage:u.customMessage,company:w,onClose:function(){return m({open:!1,customMessage:null})},onChange:C}),(0,j.jsx)(je,{company:w,intention:Z,message:v.find((function(e){return e.intention===Z})),onClose:function(){return N(null)},editBotResponseMessages:C,openEditorNewMessage:m})]})}var Ze=t(79638),Ne=t(49795),we=t(57829),_e=t(54641),ke=t(94469),Ce=t(33604),Me=t(61113),ze=t(96467),Ee=t(4117);function Se(e){var n=e.open,t=e.onClose,a=e.onConfirm;return(0,j.jsxs)(ke.Z,{open:n,onClose:t,maxWidth:"sm",fullWidth:!0,children:[(0,j.jsx)(Ce.Z,{className:"pb-8 pl-4",children:(0,j.jsxs)(we.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,j.jsx)("span",{role:"img","aria-label":"rocket",style:{fontSize:"1.5rem"},children:"\ud83d\ude80"}),(0,j.jsx)(Me.Z,{variant:"h6",children:"Nova funcionalidade!"})]})}),(0,j.jsxs)(ze.Z,{children:[(0,j.jsxs)(Me.Z,{variant:"body1",paragraph:!0,children:["Voc\xea est\xe1 prestes a ativar nossa ",(0,j.jsx)("strong",{children:"Nova IA"})," para o ChatBot! \ud83e\udd16\u2728"]}),(0,j.jsxs)(Me.Z,{variant:"body1",paragraph:!0,children:["Esta \xe9 uma funcionalidade ",(0,j.jsx)("strong",{children:"nova e experimental"})," que vai deixar seu ChatBot muito mais inteligente e capaz de entender melhor o que seus clientes querem."]}),(0,j.jsx)(we.Z,{sx:{borderRadius:1,p:2,mt:2},className:"border border-blue-300 border-solid bg-blue-50",children:(0,j.jsxs)(Me.Z,{variant:"body2",className:"text-blue-600",fontWeight:"medium",children:[(0,j.jsx)("strong",{children:"Boa not\xedcia:"})," Por enquanto, esta funcionalidade est\xe1 dispon\xedvel ",(0,j.jsx)("strong",{children:"gratuitamente"})," enquanto est\xe1 em fase de testes!"]})}),(0,j.jsx)(Me.Z,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Voc\xea pode desativar a qualquer momento se preferir voltar ao ChatBot padr\xe3o."})]}),(0,j.jsxs)(Ee.Z,{children:[(0,j.jsx)(ce.Z,{onClick:t,color:"inherit",children:"Cancelar"}),(0,j.jsx)(ce.Z,{onClick:a,variant:"contained",color:"primary",autoFocus:!0,children:"Ativar nova IA"})]})]})}var Ve=t(55685),Ie=t(83929),Ae=t(74268),We=t(47131),Be=t(79176),Re="https://ai-api.cardapioweb.com";function qe(e){return Oe.apply(this,arguments)}function Oe(){return(Oe=(0,r.Z)(c().mark((function e(n){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.Z.get("".concat(Re,"/v1/bot-personality/questions/").concat(n));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Le(e,n){return Pe.apply(this,arguments)}function Pe(){return(Pe=(0,r.Z)(c().mark((function e(n,t){var a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.Z.put("".concat(Re,"/v1/bot-personality/").concat(n),t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var De=t(58302),Te=function(){var e=(0,r.Z)(c().mark((function e(n){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qe(n);case 2:return t=e.sent,e.abrupt("return",null===t||void 0===t?void 0:t.data);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();var Fe=["Personalidade","Estilo de Comunica\xe7\xe3o","N\xedvel de Detalhamento","Uso de Emojis","Instru\xe7\xf5es Espec\xedficas"];function He(e){var n=e.open,t=e.onClose,a=e.companyId,s=(0,F.VY)(),l=d.useState(0),u=(0,o.Z)(l,2),m=u[0],x=u[1],f=d.useState(!1),h=(0,o.Z)(f,2),g=h[0],b=h[1],y=d.useState({personality:"",communicationStyle:"",detailLevel:"",emojiUsage:"",customInstructions:""}),Z=(0,o.Z)(y,2),N=Z[0],w=Z[1],_=function(e){var n=(0,I.Z)(e?"bot-personality-questions-".concat(e):null,(function(){return Te(e)}),{dedupingInterval:3e4,revalidateOnFocus:!1}),t=n.data,a=n.error,s=n.isValidating,r=n.mutate,i=n.isLoading;return{questions:null===t||void 0===t?void 0:t.questions,isLoading:i,isError:a,isValidating:s,mutate:r}}(a),k=_.questions,C=_.isLoading,M=_.isError,z=_.mutate;d.useEffect((function(){if(k&&n){var e={personality:k.personality.currentValue||"",communicationStyle:k.communicationStyle.currentValue||"",detailLevel:k.detailLevel.currentValue||"",emojiUsage:k.emojiUsage.currentValue||"",customInstructions:k.customInstructions.currentValue||""};w(e),x(0)}}),[k,n]);var E=function(e,n){w((function(t){return(0,i.Z)((0,i.Z)({},t),{},(0,p.Z)({},e,n))}))},S=function(){var e=(0,r.Z)(c().mark((function e(){var n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,b(!0),e.next=4,Le(a,N);case 4:if("success"!==e.sent.status){e.next=13;break}return s.success("Personalidade do bot atualizada com sucesso!"),e.next=9,z();case 9:x(0),t(),e.next=14;break;case 13:s.error("Erro ao atualizar personalidade");case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),s.error((null===e.t0||void 0===e.t0||null===(n=e.t0.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.message)||"Erro ao salvar configura\xe7\xf5es personalizadas",{autoHideDuration:6e3});case 19:return e.prev=19,b(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[0,16,19,22]])})));return function(){return e.apply(this,arguments)}}();if(C)return(0,j.jsx)(ke.Z,{open:n,onClose:t,maxWidth:"sm",fullWidth:!0,children:(0,j.jsx)(ze.Z,{children:(0,j.jsx)("div",{className:"flex justify-center items-center min-h-[200px]",children:(0,j.jsx)(G.Z,{})})})});if(M)return(0,j.jsxs)(ke.Z,{open:n,onClose:t,maxWidth:"sm",fullWidth:!0,children:[(0,j.jsx)(Ce.Z,{className:"pb-4",children:(0,j.jsxs)("div",{className:"flex items-center justify-between text-slate-700",children:[(0,j.jsxs)("div",{className:"flex items-center gap-2",children:[(0,j.jsx)("span",{role:"img","aria-label":"robot",className:"text-xl pb-1",children:"\ud83e\udd16"}),(0,j.jsx)("h6",{className:"text-lg font-medium",children:"Personalizar ChatBot"})]}),(0,j.jsx)(We.Z,{color:"inherit",onClick:t,size:"small",children:(0,j.jsx)(De.Z,{})})]})}),(0,j.jsx)(ze.Z,{children:(0,j.jsx)("div",{className:"flex flex-col justify-center items-center min-h-[200px] text-center",children:(0,j.jsx)("div",{className:"text-red-500 mb-2",children:"Erro ao carregar configura\xe7\xf5es"})})})]});var V=(m+1)/Fe.length*100;return(0,j.jsxs)(ke.Z,{open:n,onClose:t,maxWidth:"sm",fullWidth:!0,children:[(0,j.jsx)(Ce.Z,{className:"pb-4",children:(0,j.jsxs)("div",{className:"flex items-center justify-between text-slate-700",children:[(0,j.jsxs)("div",{className:"flex items-center gap-2",children:[(0,j.jsx)("span",{role:"img","aria-label":"robot",className:"text-xl pb-1",children:"\ud83e\udd16"}),(0,j.jsx)("h6",{className:"text-lg font-medium",children:"Personalizar ChatBot"})]}),(0,j.jsx)(We.Z,{color:"inherit",onClick:t,size:"small",children:(0,j.jsx)(De.Z,{})})]})}),(0,j.jsxs)(ze.Z,{className:"px-4 py-2",children:[(0,j.jsxs)("div",{className:"mb-4",children:[(0,j.jsxs)("div",{className:"mb-2",children:[(0,j.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[(0,j.jsxs)("span",{children:["Passo ",m+1," de ",Fe.length]}),(0,j.jsxs)("span",{children:[Math.round(V),"%"]})]}),(0,j.jsx)(Be.Z,{variant:"determinate",value:V,sx:{height:6,borderRadius:3,backgroundColor:"#e5e7eb","& .MuiLinearProgress-bar":{backgroundColor:"#8b5cf6",borderRadius:3}}})]}),(0,j.jsx)("div",{className:"text-center text-sm text-gray-600 mb-8 font-medium",children:Fe[m]})]}),(0,j.jsx)("div",{className:"min-h-[200px]",children:function(e){if(!k)return null;var n=Object.keys(k)[e],t=k[n];return 4===e?(0,j.jsxs)("div",{children:[(0,j.jsx)("h6",{className:"text-base font-medium mb-2",children:t.question}),(0,j.jsx)("p",{className:"mb-4 text-xs text-gray-500",children:t.description}),(0,j.jsx)(v.Z,{fullWidth:!0,multiline:!0,rows:5,size:"small",placeholder:t.placeholder,value:N.customInstructions,onChange:function(e){return E("customInstructions",e.target.value)},inputProps:{maxLength:1e3,style:{resize:"vertical"}},helperText:"".concat(N.customInstructions.length,"/1000 caracteres")})]}):(0,j.jsxs)("div",{children:[(0,j.jsx)("h6",{className:"text-base font-medium mb-4",children:t.question}),(0,j.jsx)(Ve.Z,{value:N[n],onChange:function(e){return E(n,e.target.value)},children:t.options.map((function(e){return(0,j.jsx)(Ie.Z,{value:e.value,control:(0,j.jsx)(Ae.Z,{size:"small"}),label:(0,j.jsxs)("div",{className:"gap-1",children:[(0,j.jsx)("div",{className:"text-sm",children:e.label}),(0,j.jsx)("div",{className:"text-xs text-gray-500",children:e.description})]}),className:"mb-4"},e.value)}))})]})}(m)})]}),(0,j.jsxs)(Ee.Z,{className:"px-4 py-2 gap-2",children:[(0,j.jsx)(ce.Z,{size:"small",disabled:0===m,onClick:function(){x((function(e){return e-1}))},children:"Voltar"}),(0,j.jsx)(ce.Z,{size:"small",variant:"contained",onClick:m===Fe.length-1?S:function(){x((function(e){return e+1}))},disabled:!function(){var e=Object.keys(N)[m];return N[e]||"customInstructions"===e}()||g,children:g?(0,j.jsx)(G.Z,{size:16}):m===Fe.length-1?"Salvar":"Pr\xf3ximo"})]})]})}var Ue=t(14999),Ke=t(80059);var Ye=function(){var e=(0,F.VY)(),n=(0,T.I0)(),t=d.useState(!1),a=(0,o.Z)(t,2),s=a[0],i=a[1],l=d.useState(!1),u=(0,o.Z)(l,2),m=u[0],p=u[1],x=d.useState(!1),f=(0,o.Z)(x,2),v=f[0],h=f[1],b=d.useState(!1),y=(0,o.Z)(b,2),Z=y[0],N=y[1],w=(0,T.v9)((function(e){return e.main.company.company.flags})),_=(0,T.v9)((function(e){return e.main.company.company.id})),k=d.useMemo((function(){return!(null===w||void 0===w||!w.chatbot_cwai_active)}),[null===w||void 0===w?void 0:w.chatbot_cwai_active]),C=d.useCallback(function(){var t=(0,r.Z)(c().mark((function t(a){var s,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i(!0),t.next=4,P(_,w,"chatbot_cwai_active",a);case 4:void 0!==(null===(r=t.sent)||void 0===r||null===(s=r.flags)||void 0===s?void 0:s.chatbot_cwai_active)?(n((0,Ne.bV)(r.flags)),e.success("Salvo com sucesso. Atualize a p\xe1gina para aplicar as altera\xe7\xf5es")):e.error("N\xe3o foi poss\xedvel concluir a opera\xe7\xe3o"),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),e.error(t.t0.message||"N\xe3o foi poss\xedvel concluir a opera\xe7\xe3o");case 11:return t.prev=11,i(!1),t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[0,8,11,14]])})));return function(e){return t.apply(this,arguments)}}(),[_,w,e,n]),M=d.useCallback((function(e){e&&!k?(h(e),p(!0)):C(e)}),[k,C]),z=d.useCallback((function(){p(!1),C(v)}),[v,C]),E=d.useCallback((function(){p(!1),h(!1)}),[]);return null!==w&&void 0!==w&&w.chatbot_cwai_feature_enabled?(0,j.jsx)(_e.W,{children:(0,j.jsxs)("div",{className:"px-3 space-y-1",children:[(0,j.jsxs)(we.Z,{sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:1,p:1.5,position:"relative",overflow:"hidden",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.1)"},children:[(0,j.jsxs)("div",{className:"flex items-center justify-between space-x-3 font-medium text-white",children:[(0,j.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,j.jsx)(Ke.Z,{sx:{color:"white",fontSize:24}}),(0,j.jsx)("span",{className:"text-lg font-bold",children:"Nova IA do ChatBot"}),!1]}),(0,j.jsxs)("div",{className:"flex items-center space-x-2",children:[s&&(0,j.jsx)(G.Z,{size:18,color:"inherit"}),(0,j.jsx)(g.Z,{checked:k,disabled:s,onClick:function(e){return M(e.target.checked)}})]})]}),(0,j.jsx)("div",{className:"pt-2",children:(0,j.jsx)(ce.Z,{size:"small",variant:"text",onClick:function(){return N(!0)},startIcon:(0,j.jsx)(Ue.Z,{}),disabled:s||!k,sx:{color:"white","&:hover":{backgroundColor:"rgba(255,255,255,0.1)"},"&:disabled":{color:"rgba(255,255,255,0.5)"}},children:"Personalizar ChatBot"})})]}),(0,j.jsx)(Se,{open:m,onClose:E,onConfirm:z}),(0,j.jsx)(He,{open:Z,onClose:function(){return N(!1)},companyId:_})]})}):null},Je={delivery:"Delivery",takeout:"Retirada",onsite:"No local"};function Xe(){var e=(0,Ze.ZP)().hasModule,n=(0,F.VY)(),t=(0,T.I0)(),a=W(),s=a.data,l=a.mutate,p=d.useState(!1),x=(0,o.Z)(p,2),f=x[0],v=x[1],h=d.useState({}),Z=(0,o.Z)(h,2),N=Z[0],w=Z[1],_=d.useState(!1),k=(0,o.Z)(_,2),C=k[0],M=k[1],z=(0,T.v9)((function(e){return e.main.company.company.flags})),E=(0,T.v9)((function(e){return e.main.company.company.id})),S=(0,T.v9)((function(e){return e.main.company.companyPaymentMethods})),I=d.useMemo((function(){return e(Ze.qz.CHATBOT)}),[e]),A=d.useState(I?0:1),B=(0,o.Z)(A,2),q=B[0],O=B[1];function L(e){w((function(n){return(0,i.Z)((0,i.Z)({},n),e||{})}))}function D(){return(D=(0,r.Z)(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N){e.next=2;break}return e.abrupt("return");case 2:return v(!0),e.prev=3,e.next=6,R(N);case 6:return t=e.sent,e.next=9,l(t,{revalidate:!1});case 9:(0,U.g0)(),n.success("Salvo com sucesso!"),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),n.error(e.t0.message||"N\xe3o foi poss\xedvel concluir a opera\xe7\xe3o");case 16:v(!1);case 17:case"end":return e.stop()}}),e,null,[[3,13]])})))).apply(this,arguments)}d.useEffect((function(){s&&w(s)}),[s]),d.useEffect((function(){var e;null!==(e=window.chrome)&&void 0!==e&&e.storage&&(0,Y.PM)(["orderNotificationsDisabled"]).then((function(e){M(!!e.orderNotificationsDisabled)}))}),[]);var Q=d.useMemo((function(){return b.U.filter((function(e){return!!("scheduled_confirmed"!==e.id||null!==z&&void 0!==z&&z.work_with_scheduled_order)&&(!!("released"!==e.id||null!==z&&void 0!==z&&z.work_with_delivery)&&!("pending_online_payment"===e.id&&!S.some((function(e){return e.kind===K.X_.pix_auto.id}))))}))}),[z,S]),$=d.useCallback(function(){var e=(0,r.Z)(c().mark((function e(a){var s,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,v(!0),e.next=4,P(E,z,"chatbot_save_contacts_automatically",a);case 4:void 0!==(null===(r=e.sent)||void 0===r||null===(s=r.flags)||void 0===s?void 0:s.chatbot_save_contacts_automatically)?(t((0,Ne.bV)(r.flags)),n.success("Salvo com sucesso. Atualize a p\xe1gina para aplicar as altera\xe7\xf5es")):n.error("N\xe3o foi poss\xedvel concluir a opera\xe7\xe3o"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n.error(e.t0.message||"N\xe3o foi poss\xedvel concluir a opera\xe7\xe3o");case 11:return e.prev=11,v(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,8,11,14]])})));return function(n){return e.apply(this,arguments)}}(),[E,z,n,t]);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(J.Z,{value:q,onChange:function(e,n){O(n)},indicatorColor:"primary",textColor:"primary",className:"",children:[I&&(0,j.jsx)(X.Z,{value:0,className:"flex-1",label:"Configura\xe7\xf5es"}),(0,j.jsx)(X.Z,{value:1,className:"flex-1",label:"Notifica\xe7\xf5es"})]}),(0,j.jsx)(m.Z,{}),I&&0===q&&(0,j.jsxs)("div",{className:"overflow-auto",children:[(0,j.jsxs)("div",{className:"mb-8 space-y-4 pt-4",children:[(0,j.jsxs)("div",{className:"px-3 space-y-1",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between space-x-3 font-medium",children:[(0,j.jsx)("span",{children:"Salvar clientes automaticamente"}),(0,j.jsxs)("div",{className:"flex items-center space-x-2",children:[f&&(0,j.jsx)(G.Z,{size:18,color:"primary"}),(0,j.jsx)(g.Z,{checked:!(null===z||void 0===z||!z.chatbot_save_contacts_automatically),disabled:f,onClick:function(e){return $(e.target.checked)}})]})]}),(0,j.jsx)("div",{className:"font-light text-gray-500",children:"O ChatBot salva automaticamente no sistema os contatos dos clientes que falam com ele."})]}),(0,j.jsx)(Ye,{})]}),(0,j.jsx)(ye,{})]}),1===q&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{className:"flex justify-between items-center px-3 py-3.5 space-x-1.5 bg-gray-100 font-medium",children:[(0,j.jsx)("span",{children:"Notifica\xe7\xf5es via WhatsApp"}),(0,j.jsx)(g.Z,{checked:!!N.notification_via_whatsapp_active,onClick:function(e){return w((function(n){return(0,i.Z)((0,i.Z)({},n),{},{notification_via_whatsapp_active:e.target.checked})}))}})]}),(0,j.jsx)(m.Z,{}),N.notification_via_whatsapp_active&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{className:"px-3 py-3.5 space-y-1",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between space-x-3 font-medium",children:[(0,j.jsx)("span",{children:"Enviar notifica\xe7\xf5es atrav\xe9s deste navegador"}),(0,j.jsx)(g.Z,{checked:!C,onClick:function(){M((function(e){return(0,Y.EH)("orderNotificationsDisabled",!e),!e}))}})]}),(0,j.jsx)("div",{className:"font-light text-gray-500",children:"Isso permite controlar qual Cardapinho ir\xe1 fazer o envio das notifica\xe7\xf5es no caso em que a extens\xe3o est\xe1 aberta em mais de um computador."})]}),(0,j.jsx)(m.Z,{})]}),(0,j.jsxs)("div",{className:(0,H.Z)("flex-1 p-3 space-y-3 overflow-auto",!N.notification_via_whatsapp_active&&"opacity-60"),children:[(0,j.jsx)("div",{className:"py-2",children:(0,j.jsxs)("div",{className:"flex items-center justify-between space-x-3 font-medium",children:[(0,j.jsx)("div",{className:"flex-1",children:"Notificar pedidos realizados pelo portal"}),(0,j.jsx)(V,{label:"Tipos de pedido",name:"portal_order_types",value:(null===N||void 0===N?void 0:N.notify_via_whatsapp_portal_order_types)||[],onChange:function(e){return L({notify_via_whatsapp_portal_order_types:e.target.value})},optionValueKey:"key",optionLabelKey:"label",options:Object.keys(Je).map((function(e){var n;return{key:e,label:Je[e],checked:null===N||void 0===N||null===(n=N.notify_via_whatsapp_portal_order_types)||void 0===n?void 0:n.includes(e)}})),renderValue:function(e){return e.length===Object.keys(Je).length?"Todos os pedidos":e.map((function(e){return Je[e]})).join(", ")},className:"w-40 bg-white"})]})}),(0,j.jsx)(m.Z,{}),Q.map((function(e){return(0,j.jsx)(y,{id:e.id,label:e.label,active:!!N["".concat(e.id,"_notification_active")],customMessage:N["".concat(e.id,"_notification_message")],customizableMessage:"pending_online_payment"!==e.id,onUpdate:L},e.id)}))]}),(0,j.jsx)("div",{className:"flex items-center p-3 border-0 border-t border-gray-200 border-solid justify-cente",children:(0,j.jsx)(u.Z,{size:"large",color:"primary",variant:"contained",onClick:function(){return D.apply(this,arguments)},disableElevation:!0,fullWidth:!0,loading:f,children:"Salvar configura\xe7\xf5es"})})]})]})}var Ge=function(){var e=W(),n=e.isLoading,t=e.isError;return n?(0,j.jsx)(s.Z,{}):t?(0,j.jsx)(a.Z,{title:"N\xe3o foi poss\xedvel carregar as informa\xe7\xf5es"}):(0,j.jsx)(Xe,{})}}}]);